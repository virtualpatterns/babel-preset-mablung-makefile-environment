// // const Clone = require('clone')
// // const Is = require('@pwn/is')

// // const Package = require('../package.json')

// // module.exports = function (api, option) {

// //   // {
// //   //   "overrides": [
// //   //     {
// //   //       "include": [
// //   //         "source/**/*.cjs"
// //   //       ],
// //   //       "presets": [
// //   //         [
// //   //           "@babel/preset-env",
// //   //           {
// //   //             "targets": {
// //   //               "node": "current"
// //   //             }
// //   //           }
// //   //         ]
// //   //       ]
// //   //     },
// //   //     {
// //   //       "exclude": [
// //   //         "source/header/"
// //   //       ],
// //   //       "plugins": [
// //   //         [
// //   //           "babel-plugin-add-header-comment",
// //   //           {
// //   //             "header": [
// //   //               "!node release/header/index.js"
// //   //             ]
// //   //           }
// //   //         ]
// //   //       ]
// //   //     }
// //   //   ]
// //   // },

// //   let configuration = Clone(Package.babel)

// //   let name = null
// //   name = configuration.overrides[0].presets[0][0]

// //   // console.log(`configuration.overrides[0].presets[0][0] = require('${name}')`)
// //   configuration.overrides[0].presets[0][0] = require(name)

// //   let exclude = null
// //   exclude = option.header?.exclude || []
// //   exclude = Is.array(exclude) ? exclude : [exclude]

// //   // console.log(`configuration.overrides[1].exclude.push('${exclude.join('\', \'')}')`)
// //   configuration.overrides[1].exclude.push(...exclude)

// //   name = configuration.overrides[1].plugins[0][0]

// //   // console.log(`configuration.overrides[1].plugins[0][0] = require('${name}')`)
// //   configuration.overrides[1].plugins[0][0] = require(name)

// //   return configuration

// // }

// const Clone = require('clone')
// const Is = require('@pwn/is')
// const Path = require('jsonpath')

// const Package = require('../package.json')

// module.exports = function (api, option) {

//   // {
//   // "presets": [
//   //   [
//   //     "@virtualpatterns/babel-preset-mablung-makefile",
//   //     {
//   //       "header": {
//   //         "exclude": [
//   //           "source/esmodule/sandbox/",
//   //           "source/esmodule/test/",
//   //           "source/test/",
//   //           "source/index.js"
//   //         ]
//   //       }
//   //     }
//   //   ]
//   // ],
//   //     "env": {
//   //     "commonjs": {
//   //       "plugins": [
//   //         [
//   //           "@virtualpatterns/babel-plugin-mablung-replace-identifier",
//   //           {
//   //             "rule": [
//   //               {
//   //                 "searchFor": "__filePath",
//   //                 "replaceWith": "__filename"
//   //               },
//   //               {
//   //                 "searchFor": "__require",
//   //                 "replaceWith": "require"
//   //               }
//   //             ]
//   //           }
//   //         ],
//   //         [
//   //           "@virtualpatterns/babel-plugin-mablung-replace-string-literal",
//   //           {
//   //             "rule": [
//   //               {
//   //                 "searchFor": "^(\\.{1,2}\\/.*?)\\.js$",
//   //                 "replaceWith": "$1.cjs"
//   //               }
//   //             ]
//   //           }
//   //         ]
//   //       ],
//   //         "presets": [
//   //           [
//   //             "@babel/preset-env",
//   //             {
//   //               "targets": {
//   //                 "node": "current"
//   //               }
//   //             }
//   //           ]
//   //         ]
//   //     },
//   //     "esmodule": {
//   //       "plugins": [
//   //         "@babel/plugin-syntax-import-meta",
//   //         [
//   //           "@virtualpatterns/babel-plugin-mablung-replace-identifier",
//   //           {
//   //             "rule": [
//   //               {
//   //                 "searchFor": "__filePath",
//   //                 "replaceWith": "__importIdentifier.fileURLToPath(import.meta.url)",
//   //                 "parserOption": {
//   //                   "plugins": [
//   //                     "importMeta"
//   //                   ],
//   //                   "sourceType": "module"
//   //                 },
//   //                 "addImport": [
//   //                   {
//   //                     "type": "default",
//   //                     "source": "url",
//   //                     "option": {
//   //                       "nameHint": "URL"
//   //                     }
//   //                   }
//   //                 ]
//   //               },
//   //               {
//   //                 "searchFor": "__require",
//   //                 "replaceWith": "__importIdentifier(import.meta.url)",
//   //                 "parserOption": {
//   //                   "plugins": [
//   //                     "importMeta"
//   //                   ],
//   //                   "sourceType": "module"
//   //                 },
//   //                 "addImport": [
//   //                   {
//   //                     "type": "named",
//   //                     "name": "createRequire",
//   //                     "source": "module"
//   //                   }
//   //                 ]
//   //               }
//   //             ]
//   //           }
//   //         ]
//   //       ]
//   //     }
//   //   }
//   // },

//   let configuration = Clone(Package.babel)

//   let plugins = Path.query(configuration, '$..plugins')

//   plugins.forEach((plugins) => {

//     plugins.forEach((plugin, index, plugins) => {

//       if (Is.array(plugin)) {
//         // console.log(`plugin[0] = ${plugin[0] == 'importMeta' ? `'${plugin[0]}'` : `require('${plugin[0]}')`}`)
//         plugin[0] = plugin[0] == 'importMeta' ? plugin[0] : require(plugin[0])
//       } else {
//         // console.log(`plugins[${index}] = ${plugin == 'importMeta' ? `'${plugin}'` : `require('${plugin}')`}`)
//         plugins[index] = plugin == 'importMeta' ? plugin : require(plugin)
//       }

//     })

//   })

//   let presets = Path.query(configuration, '$..presets')

//   presets.forEach((presets) => {

//     presets.forEach((preset, index, presets) => {

//       if (Is.array(preset)) {
//         // console.log(`preset[0] = require('${preset[0]}')`)
//         preset[0] = require(preset[0])
//       } else {
//         // console.log(`presets[${index}] = require('${preset}')`)
//         presets[index] = require(preset)
//       }

//     })

//   })

//   return configuration

// }

// // {
// //   "presets": [
// //     "@virtualpatterns/babel-preset-mablung-makefile"
// //   ],
// //     "env": {
// //     "commonjs": {
// //       "plugins": [
// //         [
// //           "@virtualpatterns/babel-plugin-mablung-replace-identifier",
// //           {
// //             "rule": [
// //               {
// //                 "searchFor": "__filePath",
// //                 "replaceWith": "__filename"
// //               },
// //               {
// //                 "searchFor": "__require",
// //                 "replaceWith": "require"
// //               }
// //             ]
// //           }
// //         ],
// //         [
// //           "@virtualpatterns/babel-plugin-mablung-replace-string-literal",
// //           {
// //             "rule": [
// //               {
// //                 "searchFor": "^(\\.{1,2}\\/.*?)\\.js$",
// //                 "replaceWith": "$1.cjs"
// //               }
// //             ]
// //           }
// //         ]
// //       ],
// //         "presets": [
// //           [
// //             "@babel/preset-env",
// //             {
// //               "targets": {
// //                 "node": "current"
// //               }
// //             }
// //           ]
// //         ]
// //     },
// //     "esmodule": {
// //       "plugins": [
// //         "@babel/plugin-syntax-import-meta",
// //         [
// //           "@virtualpatterns/babel-plugin-mablung-replace-identifier",
// //           {
// //             "rule": [
// //               {
// //                 "searchFor": "__filePath",
// //                 "replaceWith": "__importIdentifier.fileURLToPath(import.meta.url)",
// //                 "parserOption": {
// //                   "plugins": [
// //                     "importMeta"
// //                   ],
// //                   "sourceType": "module"
// //                 },
// //                 "addImport": [
// //                   {
// //                     "type": "default",
// //                     "source": "url",
// //                     "option": {
// //                       "nameHint": "URL"
// //                     }
// //                   }
// //                 ]
// //               },
// //               {
// //                 "searchFor": "__require",
// //                 "replaceWith": "__importIdentifier(import.meta.url)",
// //                 "parserOption": {
// //                   "plugins": [
// //                     "importMeta"
// //                   ],
// //                   "sourceType": "module"
// //                 },
// //                 "addImport": [
// //                   {
// //                     "type": "named",
// //                     "name": "createRequire",
// //                     "source": "module"
// //                   }
// //                 ]
// //               }
// //             ]
// //           }
// //         ]
// //       ]
// //     }
// //   }
// // }
